#Ansible playbook to backup devices based on IOS version
# the backup files will be created in folders based on hostname
# and will be date stamped
---
- name: Backup running configuration based on IOS version
  hosts: Core1
  connection: network_cli
  gather_facts: False

  tasks:

  - name: Get ansible date/time facts
    setup:
      filter: "ansible_date_time"
      gather_subset: "!all"

  - name: Store DTG as fact
    set_fact:
      DTG: "{{ ansible_date_time.date }}"

  - name: backup running-config (IOSXE devices)
    cisco.ios.ios_config:
      backup: true
      backup_options:
        dir_path: "config_backups/IOSXE/{{ inventory_hostname }}"
        filename: "initial_running_config.{{ DTG }}.cfg"
    when: ansible_network_os == "cisco.ios.ios"

  - name: backup running-config (NXOS devices)
    cisco.nxos.nxos_config:
      backup: true
      backup_options:
        dir_path: "config_backups/NXOS/{{ inventory_hostname }}"
        filename: "initial_running_config.{{ DTG }}.cfg"
    when: ansible_network_os == "cisco.nxos.nxos"
...
